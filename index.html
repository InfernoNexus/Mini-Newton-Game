
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Newton & Gravity: Enhanced Edition</title>
<style>
body {
  margin: 0;
  text-align: center;
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(#b3e5fc, #e1f5fe);
  overflow: hidden;
}
canvas {
  display: block;
  margin: 20px auto;
  background: #87ceeb;
  border: 5px solid #2e7d32;
  border-radius: 40px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

#controls {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin-top: 10px;
}
#controls button {
  font-size: 40px;
  width: 85px;
  height: 85px;
  border-radius: 50%;
  border: none;
  background: linear-gradient(#4caf50, #2e7d32);
  color: white;
  box-shadow: 0 6px #1b5e20;
  cursor: pointer;
  touch-action: manipulation;
}
#controls button:active {
  box-shadow: 0 2px #1b5e20;
  transform: translateY(4px);
}

.restart-btn {
  margin-top: 15px;
  font-size: 20px;
  font-weight: bold;
  padding: 12px 30px;
  border-radius: 50px;
  border: none;
  background: #ff5252;
  color: white;
  box-shadow: 0 4px #c62828;
  cursor: pointer;
}
.restart-btn:active {
  box-shadow: 0 1px #c62828;
  transform: translateY(2px);
}

@media (max-width: 600px) {
  canvas { width: 95%; height: auto; margin: 10px auto; }
}
</style>
</head>
<body>

<h2 style="color: #2e7d32; text-shadow: 1px 1px white;">üçé Newton's Orchard üçé</h2>
<canvas id="game" width="520" height="620"></canvas>

<div id="mobile-ui">
  <div id="controls">
    <button id="leftBtn">‚óÄ</button>
    <button id="rightBtn">‚ñ∂</button>
  </div>
  <button class="restart-btn" onclick="restartGame()">Restart Game</button>
</div>

<audio id="bgm" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0f7c38a88e.mp3?filename=peaceful-garden-12257.mp3">
</audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const music = document.getElementById("bgm");

// ---------------- VARIABLES ----------------
let newtonX = 215;
let appleX = Math.random() * 480;
let appleY = 0;
let score = 0;
let speed = 5;
let lives = 1;
let gameOver = false;
let isGolden = false;

let clouds = [
  { x: 50, y: 80, speed: 0.3 },
  { x: 250, y: 120, speed: 0.2 },
  { x: 400, y: 60, speed: 0.25 }
];

// ---------------- TEXTURES ----------------

// 1. Enhanced Bark Texture
const barkTexture = document.createElement("canvas");
barkTexture.width = 60;
barkTexture.height = 300;
const barkCtx = barkTexture.getContext("2d");
barkCtx.fillStyle = "#5d4037";
barkCtx.fillRect(0,0,60,300);
for(let i=0; i<100; i++){
  barkCtx.strokeStyle = "rgba(40,20,10,0.3)";
  barkCtx.lineWidth = Math.random()*3;
  let x = Math.random()*60;
  barkCtx.beginPath();
  barkCtx.moveTo(x, 0);
  barkCtx.lineTo(x + (Math.random()*4-2), 300);
  barkCtx.stroke();
}

// 2. HIGHLY TEXTURED GRASS
const grassTexture = document.createElement("canvas");
grassTexture.width = canvas.width;
grassTexture.height = 180;
const grassCtx = grassTexture.getContext("2d");

// Base Gradient
const g = grassCtx.createLinearGradient(0,0,0,180);
g.addColorStop(0,"#66bb6a");
g.addColorStop(1,"#1b5e20");
grassCtx.fillStyle = g;
grassCtx.fillRect(0,0,grassTexture.width,180);

// Draw thousands of individual blades
function drawGrassBlades() {
    const colors = ["#2e7d32", "#388e3c", "#43a047", "#1b5e20", "#81c784"];
    for(let i=0; i<1200; i++){
        let x = Math.random() * grassTexture.width;
        let y = 30 + Math.random() * 150; // Randomize start height for depth
        let h = 15 + Math.random() * 25;
        let lean = Math.random() * 10 - 5;
        
        grassCtx.strokeStyle = colors[Math.floor(Math.random()*colors.length)];
        grassCtx.lineWidth = 1 + Math.random() * 2;
        grassCtx.beginPath();
        grassCtx.moveTo(x, y);
        // Bezier curve for organic look
        grassCtx.quadraticCurveTo(x + lean, y - h/2, x + (lean*1.5), y - h);
        grassCtx.stroke();
    }
    
    // Add some tiny wildflowers
    const flowers = ["#fff", "#ffd54f", "#f48fb1"];
    for(let i=0; i<40; i++){
        grassCtx.fillStyle = flowers[Math.floor(Math.random()*flowers.length)];
        let fx = Math.random() * grassTexture.width;
        let fy = 40 + Math.random() * 120;
        grassCtx.beginPath();
        grassCtx.arc(fx, fy, 2, 0, Math.PI*2);
        grassCtx.fill();
    }
}
drawGrassBlades();

// ---------------- CONTROLS ----------------
document.addEventListener("keydown", (e) => {
    if(e.key==="ArrowLeft" && newtonX > 10) newtonX -= 35;
    if(e.key==="ArrowRight" && newtonX < 410) newtonX += 35;
});

// Smooth touch controls
document.getElementById("leftBtn").addEventListener("touchstart", (e) => { e.preventDefault(); if(newtonX>20) newtonX -= 40; });
document.getElementById("rightBtn").addEventListener("touchstart", (e) => { e.preventDefault(); if(newtonX<410) newtonX += 40; });

// ---------------- DRAW FUNCTIONS ----------------
function drawBackground(){
  // Tree trunk
  ctx.drawImage(barkTexture, 85, 200);

  // Layered Leaves (The Canopy)
  const centers = [{x:80,y:180}, {x:120,y:150}, {x:160,y:190}, {x:110,y:210}];
  centers.forEach(pos => {
    const leafGrad = ctx.createRadialGradient(pos.x, pos.y, 20, pos.x, pos.y, 80);
    leafGrad.addColorStop(0,"#a5d6a7");
    leafGrad.addColorStop(1,"#1b5e20");
    ctx.fillStyle = leafGrad;
    ctx.beginPath();
    ctx.arc(pos.x, pos.y, 60, 0, Math.PI*2);
    ctx.fill();
  });
}

function drawGrass(){ 
    ctx.drawImage(grassTexture, 0, 440); 
}

function drawClouds(){
  ctx.fillStyle="rgba(255,255,255,0.85)";
  clouds.forEach(c=>{
    ctx.beginPath();
    ctx.arc(c.x, c.y, 20, 0, Math.PI*2);
    ctx.arc(c.x+25, c.y+5, 25, 0, Math.PI*2);
    ctx.arc(c.x+55, c.y, 20, 0, Math.PI*2);
    ctx.fill();
    c.x += c.speed; 
    if(c.x > canvas.width + 100) c.x = -100;
  });
}

function drawNewton(){
  // Shadow on grass
  ctx.fillStyle="rgba(0,0,0,0.2)";
  ctx.beginPath(); ctx.ellipse(newtonX+50, 575, 45, 12, 0, 0, Math.PI*2); ctx.fill();
  
  // Body (Coat)
  ctx.fillStyle="#4e342e"; ctx.fillRect(newtonX+10, 460, 80, 95);
  // Shirt
  ctx.fillStyle="#ffffff"; ctx.fillRect(newtonX+35, 460, 30, 70);
  
  // Head
  ctx.beginPath(); ctx.arc(newtonX+50, 425, 30, 0, Math.PI*2); ctx.fillStyle="#ffdbac"; ctx.fill();
  
  // Wig/Hair
  ctx.fillStyle="#eeeeee"; 
  ctx.beginPath(); ctx.arc(newtonX+50, 410, 35, Math.PI, 0); ctx.fill();
  ctx.beginPath(); ctx.arc(newtonX+15, 425, 18, 0, Math.PI*2); ctx.arc(newtonX+85, 425, 18, 0, Math.PI*2); ctx.fill();
  
  // Eyes
  ctx.fillStyle="black"; 
  ctx.beginPath(); ctx.arc(newtonX+40, 425, 3, 0, Math.PI*2); ctx.arc(newtonX+60, 425, 3, 0, Math.PI*2); ctx.fill();
  
  // Legs
  ctx.fillStyle="#212121"; 
  ctx.fillRect(newtonX+25, 555, 18, 45); ctx.fillRect(newtonX+57, 555, 18, 45);
}

function drawApple(){
  const appleGrad = ctx.createRadialGradient(appleX-5, appleY-5, 2, appleX, appleY, 18);
  if(isGolden) {
    appleGrad.addColorStop(0, "#fffde7");
    appleGrad.addColorStop(1, "#f9a825");
  } else {
    appleGrad.addColorStop(0, "#ff8a80");
    appleGrad.addColorStop(1, "#b71c1c");
  }
  
  ctx.fillStyle = appleGrad;
  ctx.beginPath(); ctx.arc(appleX, appleY, 18, 0, Math.PI*2); ctx.fill();
  
  // Leaf/Stem
  ctx.fillStyle = "#3e2723"; ctx.fillRect(appleX-2, appleY-25, 4, 12);
  ctx.fillStyle = "green"; ctx.beginPath(); ctx.ellipse(appleX+5, appleY-22, 8, 4, Math.PI/4, 0, Math.PI*2); ctx.fill();
}

// ---------------- GAME LOGIC ----------------
function resetApple(){
  appleY = -20;
  const margin = 40; 
  appleX = margin + Math.random() * (canvas.width - margin * 2);
  isGolden = Math.random() < 0.15; // 15% chance for gold
}

function restartGame(){
  score = 0; speed = 5; lives = 1; gameOver = false;
  resetApple();
  music.volume = 0.3;
  music.play().catch(() => console.log("Music interaction required"));
  gameLoop();
}

function gameLoop(){
  if(gameOver){
    ctx.fillStyle = "rgba(0,0,0,0.7)"; ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "white"; ctx.textAlign = "center";
    ctx.font = "bold 45px Arial"; ctx.fillText("GAME OVER", canvas.width/2, 280);
    ctx.font = "25px Arial"; ctx.fillText("Final Score: " + score, canvas.width/2, 330);
    return;
  }

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  drawClouds(); 
  drawBackground(); 
  drawGrass(); 
  drawNewton(); 
  drawApple();

  // UI Text
  ctx.textAlign = "left";
  ctx.fillStyle = "#1b5e20"; ctx.font = "bold 22px Arial";
  ctx.fillText("üçé " + score, 20, 40);
  ctx.textAlign = "right";
  ctx.fillText("‚ù§Ô∏è " + lives, 500, 40);

  appleY += speed;

  // Collision Detection
  if(appleY > 430 && appleY < 550 && appleX > newtonX && appleX < newtonX + 100){
    score += isGolden ? 10 : 1;
    if(score > 0 && score % 5 === 0) speed += 0.5;
    resetApple();
  }

  // Missed Apple
  if(appleY > canvas.height){ 
    gameOver = true; 
    music.pause(); 
  }

  requestAnimationFrame(gameLoop);
}

// ---------------- START ----------------
resetApple();
gameLoop();
</script>
</body>
</html>
